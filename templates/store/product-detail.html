{% extends "base.html" %}
{% load static %}

{% block content %}

<!-- Product Section -->
<div class="product-section">

    <!-- Product Discount -->
    <div class="product-discount">
        <span>-{{ product.get_percentage|floatformat:0 }}%</span>
    </div>

    <!-- Product Image Gallery -->
    <div class="product-images">
        <!-- Main Image -->
        <div class="main-image">
            <img src="{{ product.image.url }}" alt="{{ product.title }}" height="256" width="256" />
        </div>

        <!-- Extra Images -->
        {% if product_images %}
        <h2>Other images</h2>
        <div class="extra-images">
            {% for img in product_images %}
            <div class="extra-image">
                <img src="{{ img.url }}" alt="Additional Image" height="128" width="128" />
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <!-- Product Details -->
    <div class="product-details">
        <!-- Product Category -->
        <div class="product-category">
            <a href="{% url 'store:category-product-list' product.category.cid %}">{{ product.category.title }}</a>
        </div>

        <!-- Product Title -->
        <div class="product-title">
            <a href="{% url 'store:product-detail' product.pid %}">{{ product.title|truncatechars:50 }}</a>
        </div>

        <!-- Product Description -->
        <div class="product-description">
            <p>{{ product.description|truncatechars:100|safe }}</p>
        </div>

        <!-- Product Vendor -->
        <div class="product-vendor">
            By <a href="{% url 'store:vendor-detail' product.vendor.vid %}">{{ product.vendor.title }}</a>
        </div>

        <!-- Product Price -->
        <div class="product-price">
            <span>${{ product.price }}</span>
            <br>
            {% if product.old_price %}
            <span class="old-price">${{ product.old_price }}</span>
            {% endif %}
        </div>

        <!-- Product Properties -->
        <div class="product-properties">
            <small>Type: {{ product.type }}</small>
            <small>SKU: {{ product.sku }}</small>
            <small>MFD: {{ product.mfd|date:"d M, Y" }}</small>
            <small>Life: {{ product.life }}</small>
            <small>Stock: {{ product.stock_count }} Item{{ product.stock_count|pluralize }} In Stock</small>
        </div>
    </div>

    <br>

    <!-- Product Info Boxes -->
    <div class="info-boxes">
        <!-- Info Box 1: Address & Return/Warranty -->
        <div class="info-box">
            <div class="user-address">
                <span>üìç{{ address.city }}, {{ address.address }}</span>
                <br>
                {% if address.status %}
                <span>Verified ‚úÖ</span>
                {% else %}
                <span>Unverified ‚ùå</span>
                {% endif %}
            </div>
            <hr>
            <div class="return-warranty">
                <h5>Return & Warranty</h5>
                <span>{{ product.vendor.authentic_rating }}% Authentic</span>
                <br>
                <span>{{ product.vendor.days_return }} Days Return</span>
                <br>
                <span>{{ product.vendor.warranty_period }} Months Warranty</span>
            </div>
        </div>

        <!-- Info Box 2: Vendor Details -->
        <div class="info-box">
            <h3>Vendor</h3>
            <a href="{% url 'store:vendor-detail' product.vendor.vid %}"><h1>{{ product.vendor.title }}</h1></a>
            <div class="vendor-image">
                <img src="{{ product.vendor.image.url }}" alt="{{ product.vendor.title }}" height="256" width="256" />
            </div>
            <br>
            <div class="vendor-address">
                <span>üìçAddress: {{ product.vendor.city }}, {{ product.vendor.address }}</span>
                <br>
                <span>üéß Contact Seller: {{ product.vendor.contact }}</span>
            </div>
            <hr>
            <div class="vendor-ratings">
                <p>Rating</p>
                <h4>{{ product.vendor.rating }}%</h4>
            </div>
            <div class="vendor-shipping">
                <p>Ship on Time</p>
                <h4>{{ product.vendor.shipping_on_time }}%</h4>
            </div>
            <div class="vendor-chat-response">
                <p>Chat Response</p>
                <h4>{{ product.vendor.chat_resp_time }}%</h4>
            </div>
        </div>
    </div>

    <br>

    <!-- Full Product Description -->
    <div class="full-description">
        <h3>Description</h3>
        <p>{{ product.description|safe }}</p>
    </div>

    <br>

    <!-- Reviews -->
    <div>
        {% for review in reviews %}
        <!-- Single Review -->
        <div>
            <!-- Review User Logo & Username -->
            <div>
                <img src="{% static 'img/admin-logo.jpg' %}" alt="" height="64" width="64" />
                <a href="#">{{ review.user.username }}</a>
            </div>
            <!-- Review Content -->
            <div>
                <p>{{ review.review|safe }}</p>
            </div>
            <!-- Review Date -->
            <div>
                <span>{{ review.date|date:"d M, Y" }}</span>
            </div>
        {% endfor %}

        <!-- Review Statistics -->
        <div>
            <h1>Customer reviews</h1>
            {{ average_rating.rating|floatformat:1 }} out of 5.0
            <!-- 5 star progress -->
            <div>
                <span></span>
            </div>
            <!-- 4 star progress -->
            <div>
                <span></span>
            </div>
            <!-- 3 star progress -->
            <div>
                <span></span>
            </div>
            <!-- 2 star progress -->
            <div>
                <span></span>
            </div>
            <!-- 1 star progress -->
            <div>
                <span></span>
            </div>
        </div>
        <!-- Review form -->
         <div>
            <h3>Add a review</h3>
            <strong id="review-response">Review added</strong>
            <form method="post" action="{% url 'store:ajax-add-review' product.pid %}" id="reviewForm">

                {% csrf_token %}
                <div>
                    {{ review_form.review }}
                </div>
                <div>
                    {{ review_form.rating }}
                </div>

                <button type="submit">Submit Review</button>
            </form>
         </div>
    </div>

    <br>

    <!-- Related Products -->
    <div class="related-products">
        <h2>Related Products</h2>
        {% for related_product in products %}
        <div class="related-product">
            <!-- Product Discount -->
            <div class="product-discount">
                <span class="discount-badge">-{{ product.get_percentage|floatformat:0 }}%</span>
            </div>
            <!-- Product Image -->
            <div class="product-image">
                <img src="{{ related_product.image.url }}" alt="{{ related_product.title }}" height="128" width="128" />
            </div>
            <!-- Product Title -->
            <div class="product-title">
                <a href="{% url 'store:product-detail' related_product.pid %}">{{ related_product.title|truncatechars:50 }}</a>
            </div>
            <!-- Product Price -->
            <div class="product-price">
                <span>${{ related_product.price }}</span>
                <br>
                <span class="old-price">${{ related_product.old_price }}</span>
            </div>
        </div>
        {% endfor %}
    </div>

    <br>

    <!-- Category Filter -->
    <div class="category-filter">
        <h1>Categories</h1>
        {% for category in categories %}
        <div class="category">
            <!-- Category Image -->
            <div class="category-image">
                <img src="{{ category.image.url }}" alt="{{ category.title }}" height="128" width="128" />
            </div>
            <!-- Category Title -->
            <div class="category-title">
                <a href="{% url 'store:category-product-list' category.cid %}">{{ category.title }}</a>
            </div>
            <!-- Category Product Count -->
            <div class="category-count">
                <span>{{ category.category.count }} Product{{ category.category.count|pluralize }}</span>
            </div>
        </div>
        {% endfor %}
    </div>

</div>

{% endblock content %}